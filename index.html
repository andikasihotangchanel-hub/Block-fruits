<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Event Imlek</title>
<style>
body{margin:0;overflow:hidden;background:#87ceeb;touch-action:none}

#joystick{
 position:fixed;
 left:30px;
 bottom:40px;
 width:120px;
 height:120px;
 border-radius:50%;
 background:rgba(255,255,255,0.3);
}
#stick{
 position:absolute;
 left:40px;
 top:40px;
 width:40px;
 height:40px;
 border-radius:50%;
 background:white;
}

#jumpBtn{
 position:fixed;
 right:30px;
 bottom:40px;
 width:70px;
 height:70px;
 border-radius:50%;
 border:none;
 background:red;
 color:white;
 font-weight:bold;
}

#adminBtn{
 position:fixed;
 top:100px;
 right:20px;
 padding:15px;
 background:gold;
 color:black;
 font-weight:bold;
 display:none;
}
</style>
</head>
<body>

<div id="joystick"><div id="stick"></div></div>
<button id="jumpBtn">JUMP</button>
<button id="adminBtn">ADMIN EVENT IMLEK</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>

/* ===============================
   CEK EVENT IMLEK (FEBRUARI)
================================= */

let today = new Date();
let isImlek = (today.getMonth() === 1); // Februari

/* ===============================
   SCENE
================================= */

const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,2000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.8));
const light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(50,100,50);
scene.add(light);

/* ===============================
   GROUND
================================= */

const ground=new THREE.Mesh(
 new THREE.PlaneGeometry(400,400),
 new THREE.MeshLambertMaterial({color:0x228B22})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

/* ===============================
   PLAYER
================================= */

const player=new THREE.Mesh(
 new THREE.BoxGeometry(2,4,2),
 new THREE.MeshLambertMaterial({color:0x0066ff})
);
player.position.y=2;
scene.add(player);

let moveX=0,moveZ=0;
let velocityY=0;
let isJump=false;

/* ===============================
   COLLISION SYSTEM
================================= */

const playerBox = new THREE.Box3();
const objectBox = new THREE.Box3();
let collisionObjects = [];

/* ===============================
   JOYSTICK
================================= */

const joy=document.getElementById("joystick");
const stick=document.getElementById("stick");

joy.addEventListener("touchmove",e=>{
 const rect=joy.getBoundingClientRect();
 let x=e.touches[0].clientX-rect.left-60;
 let y=e.touches[0].clientY-rect.top-60;

 const max=40;
 x=Math.max(-max,Math.min(max,x));
 y=Math.max(-max,Math.min(max,y));

 moveX=x/max;
 moveZ=y/max;

 stick.style.left=(x+40)+"px";
 stick.style.top=(y+40)+"px";
});

joy.addEventListener("touchend",()=>{
 moveX=0;moveZ=0;
 stick.style.left="40px";
 stick.style.top="40px";
});

/* ===============================
   JUMP
================================= */

document.getElementById("jumpBtn").onclick=()=>{
 if(!isJump){
  velocityY=0.35;
  isJump=true;
 }
};

/* ===============================
   EVENT IMLEK
================================= */

if(isImlek){

 // Hapus rumah lama (jika ada sistem rumah)
 
 // Gerbang Imlek
 const gerbang=new THREE.Mesh(
  new THREE.BoxGeometry(30,15,2),
  new THREE.MeshLambertMaterial({color:0xff0000})
 );
 gerbang.position.set(0,7,-50);
 scene.add(gerbang);
 collisionObjects.push(gerbang);

 // Tiang kiri
 const tiang1=new THREE.Mesh(
  new THREE.BoxGeometry(2,15,2),
  new THREE.MeshLambertMaterial({color:0xffd700})
 );
 tiang1.position.set(-14,7,-50);
 scene.add(tiang1);
 collisionObjects.push(tiang1);

 // Tiang kanan
 const tiang2=tiang1.clone();
 tiang2.position.set(14,7,-50);
 scene.add(tiang2);
 collisionObjects.push(tiang2);

 // Angpao tantangan
 const angpao=new THREE.Mesh(
  new THREE.BoxGeometry(3,3,1),
  new THREE.MeshLambertMaterial({color:0xff0000})
 );
 angpao.position.set(0,2,-80);
 scene.add(angpao);

}

/* ===============================
   MOVEMENT + COLLISION
================================= */

function movePlayer(){

 let speed=0.6;

 let nextX = player.position.x + moveX * speed;
 let nextZ = player.position.z + moveZ * speed;

 let oldX = player.position.x;
 let oldZ = player.position.z;

 player.position.x = nextX;
 player.position.z = nextZ;

 playerBox.setFromObject(player);

 for(let obj of collisionObjects){
  objectBox.setFromObject(obj);
  if(playerBox.intersectsBox(objectBox)){
   player.position.x = oldX;
   player.position.z = oldZ;
   return;
  }
 }

}

/* ===============================
   ANIMATE
================================= */

function animate(){
 requestAnimationFrame(animate);

 movePlayer();

 player.position.y+=velocityY;
 velocityY-=0.015;

 if(player.position.y<=2){
  player.position.y=2;
  velocityY=0;
  isJump=false;
 }

 // Cek angpao
 if(isImlek){
  const angpao = scene.children.find(o=>o.position.z===-80);
  if(angpao && player.position.distanceTo(angpao.position)<4){
   scene.remove(angpao);
   document.getElementById("adminBtn").style.display="block";
  }
 }

 camera.position.set(
  player.position.x,
  player.position.y+10,
  player.position.z+20
 );
 camera.lookAt(player.position);

 renderer.render(scene,camera);
}
animate();

</script>
</body>
</html>
