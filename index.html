<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>My Platform Game</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #87ceeb;
    }

    canvas {
        display: block;
        margin: auto;
        background: white;
        border: 2px solid black;
    }
</style>
</head>

<body>

<canvas id="game"></canvas>

<script>
"use strict";

// ================= SETUP =================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 900;
canvas.height = 500;

// ================= PLAYER =================
const player = {
    x: 100,
    y: 100,
    width: 40,
    height: 40,
    speed: 4,
    sprint: 7,
    velY: 0,
    gravity: 0.6,
    jumpPower: -12,
    grounded: false,
    coins: 0,
    lives: 3
};

// ================= CONTROLS =================
const keys = {};

document.addEventListener("keydown", (e) => {
    keys[e.key] = true;
});

document.addEventListener("keyup", (e) => {
    keys[e.key] = false;
});

// ================= OBSTACLES =================
const obstacles = [
    {x: 0, y: 470, width: 900, height: 30},
    {x: 300, y: 400, width: 200, height: 20},
    {x: 650, y: 350, width: 150, height: 20}
];

// ================= COINS =================
const coins = [
    {x: 330, y: 360, width: 20, height: 20},
    {x: 680, y: 310, width: 20, height: 20}
];

// ================= COLLISION FUNCTION =================
function isColliding(a, b) {
    return (
        a.x < b.x + b.width &&
        a.x + a.width > b.x &&
        a.y < b.y + b.height &&
        a.y + a.height > b.y
    );
}

// ================= UPDATE =================
function update() {

    let moveSpeed = keys["Shift"] ? player.sprint : player.speed;

    // Gerak kiri kanan
    if (keys["ArrowLeft"]) player.x -= moveSpeed;
    if (keys["ArrowRight"]) player.x += moveSpeed;

    // Lompat
    if (keys[" "] && player.grounded) {
        player.velY = player.jumpPower;
        player.grounded = false;
    }

    // Gravity
    player.velY += player.gravity;
    player.y += player.velY;

    player.grounded = false;

    // Collision obstacle (ANTI NEMBUS)
    obstacles.forEach(ob => {
        if (isColliding(player, ob)) {

            // Dari atas (landing)
            if (player.velY > 0) {
                player.y = ob.y - player.height;
                player.velY = 0;
                player.grounded = true;
            }

            // Dari bawah
            else if (player.velY < 0) {
                player.y = ob.y + ob.height;
                player.velY = 0;
            }
        }
    });

    // Collision coin
    coins.forEach((coin, index) => {
        if (isColliding(player, coin)) {
            player.coins++;
            coins.splice(index, 1);
        }
    });

    // Batas arena
    if (player.x < 0) player.x = 0;
    if (player.x + player.width > canvas.width)
        player.x = canvas.width - player.width;
}

// ================= DRAW =================
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Player
    ctx.fillStyle = "blue";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Obstacles
    ctx.fillStyle = "brown";
    obstacles.forEach(ob => {
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
    });

    // Coins
    ctx.fillStyle = "gold";
    coins.forEach(coin => {
        ctx.fillRect(coin.x, coin.y, coin.width, coin.height);
    });

    // UI
    ctx.fillStyle = "black";
    ctx.font = "18px Arial";
    ctx.fillText("Coins: " + player.coins, 20, 30);
    ctx.fillText("Lives: " + player.lives, 20, 55);
}

// ================= GAME LOOP =================
function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();

</script>

</body>
</html>
