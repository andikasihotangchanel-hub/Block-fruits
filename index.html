<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Roblox Mobile City</title>
<style>
body { margin:0; overflow:hidden; touch-action:none; }

#jumpBtn{
 position:fixed;
 right:20px;
 bottom:40px;
 width:70px;
 height:70px;
 border-radius:50%;
 background:red;
 color:white;
 font-size:18px;
 border:none;
}

#joystick{
 position:fixed;
 left:30px;
 bottom:40px;
 width:120px;
 height:120px;
 border-radius:50%;
 background:rgba(255,255,255,0.2);
}

#stick{
 position:absolute;
 left:40px;
 top:40px;
 width:40px;
 height:40px;
 border-radius:50%;
 background:white;
}
</style>
</head>
<body>

<div id="joystick"><div id="stick"></div></div>
<button id="jumpBtn">JUMP</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>

// ===== SCENE =====
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight,0.1,2000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.6));
const light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(50,100,50);
scene.add(light);

// ===== GROUND =====
const ground=new THREE.Mesh(
 new THREE.PlaneGeometry(500,500),
 new THREE.MeshLambertMaterial({color:0x2e8b57})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

// ===== PLAYER =====
const player=new THREE.Group();

const body=new THREE.Mesh(
 new THREE.BoxGeometry(2,3,1.5),
 new THREE.MeshLambertMaterial({color:0x0066ff})
);
body.position.y=2;
player.add(body);

const head=new THREE.Mesh(
 new THREE.BoxGeometry(1.5,1.5,1.5),
 new THREE.MeshLambertMaterial({color:0xffcc99})
);
head.position.y=4;
player.add(head);

scene.add(player);

// ===== RUMAH WARNA =====
let houses=[];
let insideHouse=false;

const colors=[
 0xff4d4d,0x4da6ff,0x4dff88,
 0xffff66,0xff66ff,0xff944d
];

for(let x=-120;x<=120;x+=15){
 for(let z=-120;z<=120;z+=15){

  const house=new THREE.Mesh(
   new THREE.BoxGeometry(14,12,14),
   new THREE.MeshLambertMaterial({
    color:colors[Math.floor(Math.random()*colors.length)]
   })
  );

  house.position.set(x,6,z);
  scene.add(house);
  houses.push(house);
 }
}

// ===== INTERIOR =====
const interior=new THREE.Group();
interior.visible=false;
scene.add(interior);

const walls=new THREE.Mesh(
 new THREE.BoxGeometry(20,12,20),
 new THREE.MeshLambertMaterial({
  color:0xffffff,
  side:THREE.BackSide
 })
);
interior.add(walls);

const floor=new THREE.Mesh(
 new THREE.PlaneGeometry(20,20),
 new THREE.MeshLambertMaterial({color:0xdddddd})
);
floor.rotation.x=-Math.PI/2;
floor.position.y=-6;
interior.add(floor);

// ===== CONTROL =====
let velocityY=0;
let isJump=false;
let moveX=0,moveZ=0;
let camAngle=0;
let camDistance=15;

// Joystick
const joy=document.getElementById("joystick");
const stick=document.getElementById("stick");

joy.addEventListener("touchmove",e=>{
 const rect=joy.getBoundingClientRect();
 let x=e.touches[0].clientX-rect.left-60;
 let y=e.touches[0].clientY-rect.top-60;

 const max=40;
 x=Math.max(-max,Math.min(max,x));
 y=Math.max(-max,Math.min(max,y));

 moveX=x/max;
 moveZ=y/max;

 stick.style.left=(x+40)+"px";
 stick.style.top=(y+40)+"px";
});

joy.addEventListener("touchend",()=>{
 moveX=0; moveZ=0;
 stick.style.left="40px";
 stick.style.top="40px";
});

// Kamera geser kanan
let lastX=null;
window.addEventListener("touchmove",e=>{
 if(e.touches[0].clientX > window.innerWidth/2){
   if(lastX!==null){
     camAngle+=(e.touches[0].clientX-lastX)*0.01;
   }
   lastX=e.touches[0].clientX;
 }
});
window.addEventListener("touchend",()=>{lastX=null;});

// Jump
document.getElementById("jumpBtn").onclick=()=>{
 if(!isJump){
  velocityY=0.35;
  isJump=true;
 }
};

// ===== MASUK RUMAH =====
function checkHouseEnter(){
 houses.forEach(h=>{
  const dist=player.position.distanceTo(h.position);
  if(dist<8 && !insideHouse){
   insideHouse=true;
   interior.position.copy(h.position);
   interior.visible=true;
   velocityY=0;
   player.position.set(h.position.x,h.position.y-6,h.position.z);
  }
 });
}

// ===== KELUAR =====
function exitHouse(){
 if(insideHouse){
  insideHouse=false;
  interior.visible=false;
  player.position.y=0;
  velocityY=0;
 }
}

// ===== ANIMATE =====
function animate(){
 requestAnimationFrame(animate);

 const forward=new THREE.Vector3(Math.sin(camAngle),0,Math.cos(camAngle));
 const right=new THREE.Vector3(forward.z,0,-forward.x);

 player.position.add(forward.clone().multiplyScalar(-moveZ*0.5));
 player.position.add(right.clone().multiplyScalar(moveX*0.5));

 if(moveX!==0 || moveZ!==0){
   const angle=Math.atan2(-moveZ,moveX);
   player.rotation.y=angle-camAngle+Math.PI/2;
 }

 if(!insideHouse){
   player.position.y+=velocityY;
   velocityY-=0.015;
   if(player.position.y<=0){
    player.position.y=0;
    velocityY=0;
    isJump=false;
   }
 }

 checkHouseEnter();

 if(isJump && insideHouse){
   exitHouse();
 }

 camera.position.x=player.position.x+Math.sin(camAngle)*camDistance;
 camera.position.z=player.position.z+Math.cos(camAngle)*camDistance;
 camera.position.y=8;
 camera.lookAt(player.position);

 renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
